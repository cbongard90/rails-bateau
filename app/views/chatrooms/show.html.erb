<div class="chatroom-container">
  <div class="chat-region">
    <div class="chat-top">
      <div>
        <% participant = @chatroom.participants.reject{ |participant| participant.user == current_user }%>
        <h2>
          <%= link_to chatrooms_path, class:'text-decoration-none' do%>
            <i class="far fa-arrow-alt-circle-left"></i>
          <% end %> <%= participant.first.user.first_name%> <%= participant.first.user.last_name%>
        </h2>
      </div>
      <div>
        <%= link_to "#", class: "btn btn-dark" do%>
          <i class="fas fa-search"></i>
        <% end %>
        <%= link_to "#", class: "btn btn-dark" do%>
          <i class="fas fa-user-plus"></i>
        <% end %>
        <%= link_to new_chatroom_room_path(@chatroom), class:"btn btn-primary" do %>
          <i class="fas fa-video"></i>
        <% end %>
      </div>
    </div>
    <div id="messages" data-chatroom-id="<%= @chatroom.id%>">
      <% @chatroom.messages.reverse.each do |message|%>
        <div id="message-<%= message.id%>"
          <% if current_user == message.user %>
            class="d-flex justify-content-end"
          <% else %>
            class="d-flex justify-content-start"
          <% end %>
        >
          <div
            <% if current_user == message.user %>
              class="message-box-current-user text-light"
            <% else %>
              class="message-box-other-user text-light"
            <% end %>
          >
            <div>
              <h5><%= message.user.first_name%></h5>
              <p><%= message.content%></p>
              <small><%= message.created_at.strftime("%a %b %e at %l:%M%p") %></small>
            </div>
          </div>
        </div>
      <% end %>
    </div>
    <div class="bg-transparent text-dark text-box">
      <%= simple_form_for [ @chatroom, @message ], remote: true do |f| %>
      <div class="d-flex">
          <div class="flex-grow-1">
            <%= f.input :content,
                        label: false,
                        placeholder: "Message #{participant.first.user.first_name} #{participant.first.user.last_name}",
                        class:"chat-form" %>
          </div>
          <div class="text-right">
            <%= f.submit class:"btn btn-primary h-100 rounded-lg text-create"%>
          </div>
      </div>
      <% end %>
    </div>
  </div>
  <div class="user-chatroom-cards">
    <% @users.each do |user| %>
      <% if user != current_user %>
        <div class="card-user my-4">
          <% if user.photo.attached?%>
            <%= cl_image_tag user.photo.key, gravity: :face, crop: :thumb  %>
          <% else %>
            <img src="https://raw.githubusercontent.com/lewagon/fullstack-images/master/uikit/skateboard.jpg" />
          <% end %>
          <div class="card-user-infos">
            <h2><%= user.first_name %> <%= user.last_name %>
            <p><strong><%= user.email %></strong></p>
          </div>
          <div class="teacher-contact">
            <% if policy(Chatroom).new? %>
              <%= link_to new_chatroom_path(user: user), class:"btn btn-primary" do %>
                <i class="fas fa-comments"></i>
              <% end %>
            <% end %>
          </div>
        </div>
      <% end %>
    <% end %>
  </div>
</div>
